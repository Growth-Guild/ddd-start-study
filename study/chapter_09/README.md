# Chapter 09. 도메인 모델과 경계

## 도메인 모델과 경계
* 한 도메인은 다시 여러 하위 도메인으로 구분된다.
* 도메인 모델의 이름은 도메인마다 이름만 같고, 실제로 의미하는 바가 다르다.
  * 예를들어 카탈로그에서의 상품은 상품 이미지, 상품명, 상품 가격 등 상품의 정보 위주라면, 재고 관리에서는 실존하는 개별 객체를 추적하기 위한 목적으로 상품을 사용한다.
* 논리적으로 같은 존재처럼 보이지만 하위 도메인에 따라 다른 용어를 사용하는 경우도 있다.
  * 예를들어 사용하는 사람을 회원 도메인에서는 회원이라고 부르지만, 주문 도메인에서는 주문자, 배송 도메인에서는 보내는 사람이라고 부른다.
* 하위 도메인마다 같은 용어라도 의미가 다르고 같은 대상이라도 지칭하는 용어가 다를 수 있기 때문에 한 개의 모델로 모든 하위 도메인을 표현하려 해서는 안된다.
* 하위 도메인마다 사용하는 용어가 다르기 때문에 올바른 도메인 모델을 개발하려면 하위 도메인마다 모델을 만들어야 한다.
* 각 모델은 명시적으로 구분되는 경계를 가져서 섞이지 않도록 해야 한다.
* 모델은 특정한 컨텍스트 하에서 완전한 의미를 갖는다. 이렇게 구분되는 경계를 바운디드 컨텍스트라고 한다.

## 바운디드 컨텍스트
* 바운디드 컨텍스트는 모델의 경계를 결정하며 한 개의 바운디드 컨텍스트는 논리적으로 한 개의 모델을 갖는다.
* 바운디드 컨텍스트는 용어를 기준으로 구분한다. 기업의 팀 조직 구조에 따라 결정되기도 한다.
* 용어를 명확하게 구분하지 못해 두 하위 도메인을 하나의 바운디드 컨텍스트에서 구현하기도 한다.
* 바운디드 컨텍스트는 도메인 모델을 구분하는 경계가 되기 떄문에 구현하는 하위 도메인에 알맞은 모델을 포함한다.

## 바운디드 컨텍스트 구현
* 바운디드 컨텍스트는 도메인 모델만 포함하는 것은 아니고, 도메인 기능을 사용자에게 제공하기 위한 표현 계층, 응용계층, 인프라스트럭처 계층을 모두 포함한다.
* 도메인 기능 자체가 단순하면 DAO와 데이터 중심의 밸류 객체를 이용해서 구현할 수도 있다.

## 바운디드 컨텍스트 간 통합
* 서로 다른 바운디드 컨텍스트 간에 통합할 떄는 REST API를 사용하거나 메시지 큐를 이용할 수 있다.
* 통합할 때 구현하는 모듈은 인터페이스로 추상화하고, 이를 인프라스트럭처 계층에서 구현한다.

### 마이크로서비스와 바운디드 컨텍스트
* 바운디드 컨텍스트는 모델의 경계를 형성하는데 이러한 바운디드 컨텍스트를 마이크로 서비스로 구현하면 자연스럽게 컨텍스트별로 모델이 분리된다.
* 별도 프로세스로 개발한 바운디드 컨텍스트는 독립적으로 배포하고 모니터링하며 확장하는데 이는 마이크로서비스와 잘 어울린다.

### 바운디드 컨텍스트 간 관계
* 바운디드 컨텍스트는 다양한 방식으로 연결된다.
* 업스트림은 다운스트림의 요구사항을 수용할 수 있는 API를 만들고 이를 서비스 형태로 공개해서 서비스의 일관성을 유지할 수 있다.
* 이런 서비스를 가리켜 공개 호스트 서비스(Open Host Service)라고 한다.
* Anti Corruption Layer는 외부 시스템과의 연동을 처리하면서 외부 시스템의 도메인 모델이 내 도메인 모델을 침범하지 않도록 막아주는 역할을 한다.
* 두 바운디드 컨텍스트가 같은 모델을 공유하는 경우도 있다.
  * 예를 들어 운영자를 위한 주문 관리 도구를 개발하는 팀과 고객을 위한 주문 서비스를 개발하는 팀이 다른 경우다.
  * 두 팀은 주문을 표현하는 모델을 공유함으로써 주문과 관련된 중복 설계를 막을 수 있다.
* 이렇게 두 팀이 공유하는 모델을 공유 커널(Shared Kernel)이라고 한다.
* 공유 커널은 중복을 줄여준다는 장점이 있다.
* 반대로 두 팀이 공유하기 때문에 한 팀에서 임의로 모델을 변경하면 안 된다.
* 다른 방법은 서로 통합하지 않는 방식이 있다. 이를 독립 방식(Separate Way)이라고 한다.
* 독립 방식에서 두 컨텍스트 간의 통합은 수동으로 이루어져야 하므로 규모가 커질 수록 수동 통합에는 한계가 있다.

## 컨텍스트 맵
* 컨텍스트 맵은 시스템의 전체 구조를 보여준다.
* 하위 도메인과 일치하지 않는 바운디드 컨텍스트를 찾아 도메인에 맞게 바운디드 컨텍스트를 조절하고 사업의 핵심 도메인을 위해 조직 역량을 어떤 바운디드 컨텍스트에 집중할지 파악하는데 도음울 준다.
* 컨텍스트 맵을 그리는 규칙은 따로 없고, 서로 소통하며 이해할 수 있는 수준에서 그리면 된다.
