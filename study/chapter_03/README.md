# Chapter 3. 애그리거트

## 3.1 애그리거트
* 상위 수준 개념을 이용해서 전체 모델을 정리하면 전반적인 관계를 이애하는 데 도움이 된다.
* 애그리거트는 관련된 객체를 하나의 군으로 묶어 준다.
* 수많은 객체를 애그리거트로 묶어서 바라보면 상위 수준에서 도메인 모델 간의 관계를 파악할 수 있다.
* 애그리거트는 모델을 이해하는 데 도움을 줄 뿐만 아니라 일관성을 관리하는 기준도 된다.
* 애그리거트는 관련된 모델을 하나로 모았기 때문에 한 애그리거트에 속한 객체는 유사하거나 동일한 라이프 사이클을 갖는다.
* 애그리거트는 경계를 갖는다. 한 애그리거트에 속한 객체는 다른 애그리거트에 속하지 않는다.
* 애그리거트는 독립된 객체 군이며, 각 애그리거트는 자기 자신을 관리할 뿐 다른 애그리거트를 관리하지 않는다.

### 애그리거트의 경계를 나누는 기준
* 경계를 설정할 때 기본이 되는 것은 도메인 규칙과 요구사항이다.
* 도메인 규칙에 따라 함께 생성되는 구성요소는 한 애그리거트에 속할 가능성이 높다.
  * 예를 들어 주문할 상품 개수, 배송지 정보, 주문자 정보는 주문 시점에 함께 생성된다.
  * 주문 상품의 개수가 변경되면 도메인 규칙에 따라 총 주문 금액 또한 변경된다.
  * 이렇게 함께 변경되는 빈도가 높은 객체는 한 애그리거트에 속할 가능성이 높다.
* 'A가 B를 갖는다.'로 설계할 수 있는 요구사항이 있다면 A와 B를 한 애그리거트로 묶어서 생각할 수 있지만 반드시 그러한 것은 아니다.
  * 예를 들어 상품과 리뷰에 대한 엔티티가 있다.
  * 상품 엔티티와 리뷰 엔티티는 함께 생성되지 않고, 함께 변경되지도 읺는다.
  * 상품을 변경하는 주체가 상품 담당자라면 리뷰를 생성하고 변경하는 주체는 고객이다.
  * 상품과 리뷰의 변경이 서로에게 영향을 주지 않기 때문에 한 애그리거트에 속하지 않는다.
* 처음 도메인 모델을 만들 때는 큰 애그리거트로 보이는 것들이 많지만, 도메인에 대한 경험이 생기고 도메인 규칙을 제대로 이해할수록 애그리거트의 크기는 줄어든다.